!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e($||require("jquery")):e(jQuery)}(function(e){"use strict";var t="styler",s={idSuffix:"-styler",filePlaceholder:"Файл не выбран",fileBrowse:"Обзор...",fileNumber:"Выбрано файлов: %s",selectPlaceholder:"Выберите...",selectSearch:!1,selectSearchLimit:10,selectSearchNotFound:"Совпадений не найдено",selectSearchPlaceholder:"Поиск...",selectVisibleOptions:0,selectSmartPositioning:!0,locale:"ru",locales:{en:{filePlaceholder:"No file selected",fileBrowse:"Browse...",fileNumber:"Selected files: %s",selectPlaceholder:"Select...",selectSearchNotFound:"No matches found",selectSearchPlaceholder:"Search..."}},onSelectOpened:function(){},onSelectClosed:function(){},onFormStyled:function(){}};function i(t,i){this.element=t,this.options=e.extend({},s,i);var l=this.options.locale;void 0!==this.options.locales[l]&&e.extend(this.options,this.options.locales[l]),this.init()}function l(s){if(!e(s.target).parents().hasClass("jq-selectbox")&&"OPTION"!=s.target.nodeName&&e("div.jq-selectbox.opened").length){var i=e("div.jq-selectbox.opened"),l=e("div.jq-selectbox__search input",i),o=e("div.jq-selectbox__dropdown",i);i.find("select").data("_"+t).options.onSelectClosed.call(i),l.length&&l.val("").keyup(),o.hide().find("li.sel").addClass("selected"),i.removeClass("focused opened dropup dropdown")}}i.prototype={init:function(){var t=e(this.element),s=this.options,i=!(!navigator.userAgent.match(/(iPad|iPhone|iPod)/i)||navigator.userAgent.match(/(Windows\sPhone)/i)),o=!(!navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/(Windows\sPhone)/i));function a(){void 0!==t.attr("id")&&""!==t.attr("id")&&(this.id=t.attr("id")+s.idSuffix),this.title=t.attr("title"),this.classes=t.attr("class"),this.data=t.data()}if(t.is(":checkbox")){var d=function(){var s=new a,i=e('<div class="jq-checkbox"><div class="jq-checkbox__div"></div></div>').attr({id:s.id,title:s.title}).addClass(s.classes).data(s.data);t.after(i).prependTo(i),t.is(":checked")&&i.addClass("checked"),t.is(":disabled")&&i.addClass("disabled"),i.click(function(e){e.preventDefault(),t.triggerHandler("click"),i.is(".disabled")||(t.is(":checked")?(t.prop("checked",!1),i.removeClass("checked")):(t.prop("checked",!0),i.addClass("checked")),t.focus().change())}),t.closest("label").add('label[for="'+t.attr("id")+'"]').on("click.styler",function(t){e(t.target).is("a")||e(t.target).closest(i).length||(i.triggerHandler("click"),t.preventDefault())}),t.on("change.styler",function(){t.is(":checked")?i.addClass("checked"):i.removeClass("checked")}).on("keydown.styler",function(e){32==e.which&&i.click()}).on("focus.styler",function(){i.is(".disabled")||i.addClass("focused")}).on("blur.styler",function(){i.removeClass("focused")})};d(),t.on("refresh",function(){t.closest("label").add('label[for="'+t.attr("id")+'"]').off(".styler"),t.off(".styler").parent().before(t).remove(),d()})}else if(t.is(":radio")){var r=function(){var s=new a,i=e('<div class="jq-radio"><div class="jq-radio__div"></div></div>').attr({id:s.id,title:s.title}).addClass(s.classes).data(s.data);t.after(i).prependTo(i),t.is(":checked")&&i.addClass("checked"),t.is(":disabled")&&i.addClass("disabled"),e.fn.commonParents=function(){var t=this;return t.first().parents().filter(function(){return e(this).find(t).length===t.length})},e.fn.commonParent=function(){return e(this).commonParents().first()},i.click(function(s){if(s.preventDefault(),t.triggerHandler("click"),!i.is(".disabled")){var l=e('input[name="'+t.attr("name")+'"]');l.commonParent().find(l).prop("checked",!1).parent().removeClass("checked"),t.prop("checked",!0).parent().addClass("checked"),t.focus().change()}}),t.closest("label").add('label[for="'+t.attr("id")+'"]').on("click.styler",function(t){e(t.target).is("a")||e(t.target).closest(i).length||(i.triggerHandler("click"),t.preventDefault())}),t.on("change.styler",function(){t.parent().addClass("checked")}).on("focus.styler",function(){i.is(".disabled")||i.addClass("focused")}).on("blur.styler",function(){i.removeClass("focused")})};r(),t.on("refresh",function(){t.closest("label").add('label[for="'+t.attr("id")+'"]').off(".styler"),t.off(".styler").parent().before(t).remove(),r()})}else if(t.is(":file")){var c=function(){var i=new a,l=t.data("placeholder");void 0===l&&(l=s.filePlaceholder);var o=t.data("browse");void 0!==o&&""!==o||(o=s.fileBrowse);var d=e('<div class="jq-file"><div class="jq-file__name">'+l+'</div><div class="jq-file__browse">'+o+"</div></div>").attr({id:i.id,title:i.title}).addClass(i.classes).data(i.data);t.after(d).appendTo(d),t.is(":disabled")&&d.addClass("disabled");var r=t.val(),c=e("div.jq-file__name",d);r&&c.text(r.replace(/.+[\\\/]/,"")),t.on("change.styler",function(){var e=t.val();if(t.is("[multiple]")){e="";var i=t[0].files.length;if(i>0){var o=t.data("number");void 0===o&&(o=s.fileNumber),e=o=o.replace("%s",i)}}c.text(e.replace(/.+[\\\/]/,"")),""===e?(c.text(l),d.removeClass("changed")):d.addClass("changed")}).on("focus.styler",function(){d.addClass("focused")}).on("blur.styler",function(){d.removeClass("focused")}).on("click.styler",function(){d.removeClass("focused")})};c(),t.on("refresh",function(){t.off(".styler").parent().before(t).remove(),c()})}else if(t.is('input[type="number"]')){var n=function(){var s=new a,i=e('<div class="jq-number"><div class="jq-number__spin minus"></div><div class="jq-number__spin plus"></div></div>').attr({id:s.id,title:s.title}).addClass(s.classes).data(s.data);t.after(i).prependTo(i).wrap('<div class="jq-number__field"></div>'),t.is(":disabled")&&i.addClass("disabled");var l,o,d,r=null,c=null;void 0!==t.attr("min")&&(l=t.attr("min")),void 0!==t.attr("max")&&(o=t.attr("max")),d=void 0!==t.attr("step")&&e.isNumeric(t.attr("step"))?Number(t.attr("step")):Number(1);var n=function(s){var i,a=t.val();e.isNumeric(a)||(a=0,t.val("0")),s.is(".minus")?i=Number(a)-d:s.is(".plus")&&(i=Number(a)+d);var r=(d.toString().split(".")[1]||[]).length;if(r>0){for(var c="1";c.length<=r;)c+="0";i=Math.round(i*c)/c}e.isNumeric(l)&&e.isNumeric(o)?i>=l&&i<=o&&t.val(i):e.isNumeric(l)&&!e.isNumeric(o)?i>=l&&t.val(i):!e.isNumeric(l)&&e.isNumeric(o)?i<=o&&t.val(i):t.val(i)};i.is(".disabled")||(i.on("mousedown","div.jq-number__spin",function(){var t=e(this);n(t),r=setTimeout(function(){c=setInterval(function(){n(t)},40)},350)}).on("mouseup mouseout","div.jq-number__spin",function(){clearTimeout(r),clearInterval(c)}).on("mouseup","div.jq-number__spin",function(){t.change().trigger("input")}),t.on("focus.styler",function(){i.addClass("focused")}).on("blur.styler",function(){i.removeClass("focused")}))};n(),t.on("refresh",function(){t.off(".styler").closest(".jq-number").before(t).remove(),n()})}else if(t.is("select")){var f=function(){function d(e){var t=e.prop("scrollHeight")-e.outerHeight(),s=null,i=null;e.off("mousewheel DOMMouseScroll").on("mousewheel DOMMouseScroll",function(l){s=l.originalEvent.detail<0||l.originalEvent.wheelDelta>0?1:-1,((i=e.scrollTop())>=t&&s<0||i<=0&&s>0)&&(l.stopPropagation(),l.preventDefault())})}var r=e("option",t),c="";function n(){for(var e=0;e<r.length;e++){var t=r.eq(e),i="",l="",o="",a="",d="",n="",f="",h="",u="";t.prop("selected")&&(l="selected sel"),t.is(":disabled")&&(l="disabled"),t.is(":selected:disabled")&&(l="selected sel disabled"),void 0!==t.attr("id")&&""!==t.attr("id")&&(a=' id="'+t.attr("id")+s.idSuffix+'"'),void 0!==t.attr("title")&&""!==r.attr("title")&&(d=' title="'+t.attr("title")+'"'),void 0!==t.attr("class")&&(f=" "+t.attr("class"),u=' data-jqfs-class="'+t.attr("class")+'"');var p=t.data();for(var v in p)""!==p[v]&&(n+=" data-"+v+'="'+p[v]+'"');l+f!==""&&(o=' class="'+l+f+'"'),i="<li"+u+n+o+d+a+">"+t.html()+"</li>",t.parent().is("optgroup")&&(void 0!==t.parent().attr("class")&&(h=" "+t.parent().attr("class")),i="<li"+u+n+' class="'+l+f+" option"+h+'"'+d+a+">"+t.html()+"</li>",t.is(":first-child")&&(i='<li class="optgroup'+h+'">'+t.parent().attr("label")+"</li>"+i)),c+=i}}if(t.is("[multiple]")){if(o||i)return;!function(){var s=new a,i=e('<div class="jq-select-multiple jqselect"></div>').attr({id:s.id,title:s.title}).addClass(s.classes).data(s.data);t.after(i),n(),i.append("<ul>"+c+"</ul>");var l=e("ul",i),o=e("li",i),f=t.attr("size"),h=l.outerHeight(),u=o.outerHeight();void 0!==f&&f>0?l.css({height:u*f}):l.css({height:4*u}),h>i.height()&&(l.css("overflowY","scroll"),d(l),o.filter(".selected").length&&l.scrollTop(l.scrollTop()+o.filter(".selected").position().top)),t.prependTo(i),t.is(":disabled")?(i.addClass("disabled"),r.each(function(){e(this).is(":selected")&&o.eq(e(this).index()).addClass("selected")})):(o.filter(":not(.disabled):not(.optgroup)").click(function(s){t.focus();var i=e(this);if(s.ctrlKey||s.metaKey||i.addClass("selected"),s.shiftKey||i.addClass("first"),s.ctrlKey||s.metaKey||s.shiftKey||i.siblings().removeClass("selected first"),(s.ctrlKey||s.metaKey)&&(i.is(".selected")?i.removeClass("selected first"):i.addClass("selected first"),i.siblings().removeClass("first")),s.shiftKey){var l=!1,a=!1;i.siblings().removeClass("selected").siblings(".first").addClass("selected"),i.prevAll().each(function(){e(this).is(".first")&&(l=!0)}),i.nextAll().each(function(){e(this).is(".first")&&(a=!0)}),l&&i.prevAll().each(function(){if(e(this).is(".selected"))return!1;e(this).not(".disabled, .optgroup").addClass("selected")}),a&&i.nextAll().each(function(){if(e(this).is(".selected"))return!1;e(this).not(".disabled, .optgroup").addClass("selected")}),1==o.filter(".selected").length&&i.addClass("first")}r.prop("selected",!1),o.filter(".selected").each(function(){var t=e(this),s=t.index();t.is(".option")&&(s-=t.prevAll(".optgroup").length),r.eq(s).prop("selected",!0)}),t.change()}),r.each(function(t){e(this).data("optionIndex",t)}),t.on("change.styler",function(){o.removeClass("selected");var t=[];r.filter(":selected").each(function(){t.push(e(this).data("optionIndex"))}),o.not(".optgroup").filter(function(s){return e.inArray(s,t)>-1}).addClass("selected")}).on("focus.styler",function(){i.addClass("focused")}).on("blur.styler",function(){i.removeClass("focused")}),h>i.height()&&t.on("keydown.styler",function(e){38!=e.which&&37!=e.which&&33!=e.which||l.scrollTop(l.scrollTop()+o.filter(".selected").position().top-u),40!=e.which&&39!=e.which&&34!=e.which||l.scrollTop(l.scrollTop()+o.filter(".selected:last").position().top-l.innerHeight()+2*u)}))}()}else!function(){var i=new a,o="",f=t.data("placeholder"),h=t.data("search"),u=t.data("search-limit"),p=t.data("search-not-found"),v=t.data("search-placeholder"),m=t.data("smart-positioning");void 0===f&&(f=s.selectPlaceholder),void 0!==h&&""!==h||(h=s.selectSearch),void 0!==u&&""!==u||(u=s.selectSearchLimit),void 0!==p&&""!==p||(p=s.selectSearchNotFound),void 0===v&&(v=s.selectSearchPlaceholder),void 0!==m&&""!==m||(m=s.selectSmartPositioning);var g=e('<div class="jq-selectbox jqselect"><div class="jq-selectbox__select"><div class="jq-selectbox__select-text"></div><div class="jq-selectbox__trigger"><div class="jq-selectbox__trigger-arrow"></div></div></div></div>').attr({id:i.id,title:i.title}).addClass(i.classes).data(i.data);t.after(g).prependTo(g);var b=g.css("z-index");b=b>0?b:1;var C=e("div.jq-selectbox__select",g),x=e("div.jq-selectbox__select-text",g),y=r.filter(":selected");n(),h&&(o='<div class="jq-selectbox__search"><input type="search" autocomplete="off" placeholder="'+v+'"></div><div class="jq-selectbox__not-found">'+p+"</div>");var w=e('<div class="jq-selectbox__dropdown">'+o+"<ul>"+c+"</ul></div>");g.append(w);var q=e("ul",w),_=e("li",w),j=e("input",w),k=e("div.jq-selectbox__not-found",w).hide();_.length<u&&j.parent().hide(),""===r.first().text()&&r.first().is(":selected")&&!1!==f?x.text(f).addClass("placeholder"):x.text(y.text());var S=0,T=0;if(_.css({display:"inline-block"}),_.each(function(){var t=e(this);t.innerWidth()>S&&(S=t.innerWidth(),T=t.width())}),_.css({display:""}),x.is(".placeholder")&&x.width()>S)x.width(x.width());else{var N=g.clone().appendTo("body").width("auto"),P=N.outerWidth();N.remove(),P==g.outerWidth()&&x.width(T)}S>g.width()&&w.width(S),""===r.first().text()&&""!==t.data("placeholder")&&_.first().hide();var H=g.outerHeight(!0),A=j.parent().outerHeight(!0)||0,D=q.css("max-height"),I=_.filter(".selected");if(I.length<1&&_.first().addClass("selected sel"),void 0===_.data("li-height")){var K=_.outerHeight();!1!==f&&(K=_.eq(1).outerHeight()),_.data("li-height",K)}var O=w.css("top");if("auto"==w.css("left")&&w.css({left:0}),"auto"==w.css("top")&&(w.css({top:H}),O=H),w.hide(),I.length&&(r.first().text()!=y.text()&&g.addClass("changed"),g.data("jqfs-class",I.data("jqfs-class")),g.addClass(I.data("jqfs-class"))),t.is(":disabled"))return g.addClass("disabled"),!1;C.click(function(){e("div.jq-selectbox").filter(".opened").length&&s.onSelectClosed.call(e("div.jq-selectbox").filter(".opened")),t.focus();var i=e(window),l=_.data("li-height"),o=g.offset().top,a=i.height()-H-(o-i.scrollTop()),c=t.data("visible-options");void 0!==c&&""!==c||(c=s.selectVisibleOptions);var n=5*l,f=l*c;c>0&&c<6&&(n=f),0===c&&(f="auto");var h=function(){w.height("auto").css({bottom:"auto",top:O});var e=function(){q.css("max-height",Math.floor((a-20-A)/l)*l)};e(),q.css("max-height",f),"none"!=D&&q.css("max-height",D),a<w.outerHeight()+20&&e()};!0===m||1===m?a>n+A+20?(h(),g.removeClass("dropup").addClass("dropdown")):(function(){w.height("auto").css({top:"auto",bottom:O});var e=function(){q.css("max-height",Math.floor((o-i.scrollTop()-20-A)/l)*l)};e(),q.css("max-height",f),"none"!=D&&q.css("max-height",D),o-i.scrollTop()-20<w.outerHeight()+20&&e()}(),g.removeClass("dropdown").addClass("dropup")):!1===m||0===m?a>n+A+20&&(h(),g.removeClass("dropup").addClass("dropdown")):(w.height("auto").css({bottom:"auto",top:O}),q.css("max-height",f),"none"!=D&&q.css("max-height",D)),g.offset().left+w.outerWidth()>i.width()&&w.css({left:"auto",right:0}),e("div.jqselect").css({zIndex:b-1}).removeClass("opened"),g.css({zIndex:b}),w.is(":hidden")?(e("div.jq-selectbox__dropdown:visible").hide(),w.show(),g.addClass("opened focused"),s.onSelectOpened.call(g)):(w.hide(),g.removeClass("opened dropup dropdown"),e("div.jq-selectbox").filter(".opened").length&&s.onSelectClosed.call(g)),j.length&&(j.val("").keyup(),k.hide(),j.keyup(function(){var s=e(this).val();_.each(function(){e(this).html().match(new RegExp(".*?"+s+".*?","i"))?e(this).show():e(this).hide()}),""===r.first().text()&&""!==t.data("placeholder")&&_.first().hide(),_.filter(":visible").length<1?k.show():k.hide()})),_.filter(".selected").length&&(""===t.val()?q.scrollTop(0):(q.innerHeight()/l%2!=0&&(l/=2),q.scrollTop(q.scrollTop()+_.filter(".selected").position().top-q.innerHeight()/2+l))),d(q)}),_.hover(function(){e(this).siblings().removeClass("selected")}),_.filter(".selected").text(),_.filter(":not(.disabled):not(.optgroup)").click(function(){t.focus();var i=e(this),l=i.text();if(!i.is(".selected")){var o=i.index();o-=i.prevAll(".optgroup").length,i.addClass("selected sel").siblings().removeClass("selected sel"),r.prop("selected",!1).eq(o).prop("selected",!0),x.text(l),g.data("jqfs-class")&&g.removeClass(g.data("jqfs-class")),g.data("jqfs-class",i.data("jqfs-class")),g.addClass(i.data("jqfs-class")),t.change()}w.hide(),g.removeClass("opened dropup dropdown"),s.onSelectClosed.call(g)}),w.mouseout(function(){e("li.sel",w).addClass("selected")}),t.on("change.styler",function(){x.text(r.filter(":selected").text()).removeClass("placeholder"),_.removeClass("selected sel").not(".optgroup").eq(t[0].selectedIndex).addClass("selected sel"),r.first().text()!=_.filter(".selected").text()?g.addClass("changed"):g.removeClass("changed")}).on("focus.styler",function(){g.addClass("focused"),e("div.jqselect").not(".focused").removeClass("opened dropup dropdown").find("div.jq-selectbox__dropdown").hide()}).on("blur.styler",function(){g.removeClass("focused")}).on("keydown.styler keyup.styler",function(e){var i=_.data("li-height");""===t.val()?x.text(f).addClass("placeholder"):x.text(r.filter(":selected").text()),_.removeClass("selected sel").not(".optgroup").eq(t[0].selectedIndex).addClass("selected sel"),38!=e.which&&37!=e.which&&33!=e.which&&36!=e.which||(""===t.val()?q.scrollTop(0):q.scrollTop(q.scrollTop()+_.filter(".selected").position().top)),40!=e.which&&39!=e.which&&34!=e.which&&35!=e.which||q.scrollTop(q.scrollTop()+_.filter(".selected").position().top-q.innerHeight()+i),13==e.which&&(e.preventDefault(),w.hide(),g.removeClass("opened dropup dropdown"),s.onSelectClosed.call(g))}).on("keydown.styler",function(e){32==e.which&&(e.preventDefault(),C.click())}),l.registered||(e(document).on("click",l),l.registered=!0)}()};f(),t.on("refresh",function(){t.off(".styler").parent().before(t).remove(),f()})}else t.is(":reset")&&t.on("click",function(){setTimeout(function(){t.closest("form").find("input, select").trigger("refresh")},1)})},destroy:function(){var s=e(this.element);s.is(":checkbox")||s.is(":radio")?(s.removeData("_"+t).off(".styler refresh").removeAttr("style").parent().before(s).remove(),s.closest("label").add('label[for="'+s.attr("id")+'"]').off(".styler")):s.is('input[type="number"]')?s.removeData("_"+t).off(".styler refresh").closest(".jq-number").before(s).remove():(s.is(":file")||s.is("select"))&&s.removeData("_"+t).off(".styler refresh").removeAttr("style").parent().before(s).remove()}},e.fn[t]=function(s){var l,o=arguments;return void 0===s||"object"==typeof s?(this.each(function(){e.data(this,"_"+t)||e.data(this,"_"+t,new i(this,s))}).promise().done(function(){var s=e(this[0]).data("_"+t);s&&s.options.onFormStyled.call()}),this):"string"==typeof s&&"_"!==s[0]&&"init"!==s?(this.each(function(){var a=e.data(this,"_"+t);a instanceof i&&"function"==typeof a[s]&&(l=a[s].apply(a,Array.prototype.slice.call(o,1)))}),void 0!==l?l:this):void 0},l.registered=!1});